name: Create Release

on:
  push:
    tags:
      - "v*"

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: Install dependencies
        run: npm ci

      - name: Build project
        run: npm run build

      - name: Prepare release package
        run: |
          mkdir -p release-package

          # کپی فایل‌های static
          cp -r out release-package/static-build

          # کپی کد منبع (بدون node_modules)
          rsync -av --exclude='node_modules' --exclude='.next' --exclude='out' --exclude='.git' . release-package/source-code/

          # ایجاد راهنمای اجرا
          cat > release-package/README.md << 'EOF'
          # 🚀 پروژه احراز هویت - بسته آماده

          ## 📁 محتویات
          - `static-build/` - فایل‌های آماده HTML/CSS/JS (بدون نیاز به Node.js)
          - `source-code/` - کد منبع کامل برای توسعه‌دهندگان

          ## 🌟 روش اول: اجرای فوری (توصیه می‌شود)
          1. پوشه `static-build` را باز کنید
          2. فایل `index.html` را در مرورگر باز کنید
          3. شماره همراه وارد کنید: `09123456789`
          4. لذت ببرید! 🎉

          ## 🛠️ روش دوم: توسعه و تغییر
          ```bash
          cd source-code
          npm install
          npm run dev
          ```

          ## ✨ ویژگی‌ها
          - 🔐 سیستم احراز هویت کامل
          - 📱 طراحی Responsive
          - 🌐 کاملاً آفلاین
          - 🎨 UI/UX مدرن
          - 🔧 TypeScript + SCSS

          ## 📞 پشتیبانی
          در صورت مشکل، Issue جدید در GitHub ایجاد کنید.
          EOF

          # ایجاد فایل راه‌انداز ویندوز
          cat > release-package/Start-Windows.bat << 'EOF'
          @echo off
          echo 🚀 راه‌اندازی پروژه احراز هویت
          echo ====================================
          echo.

          if exist "static-build\index.html" (
              echo ✅ فایل‌های آماده پیدا شد!
              echo 🌐 باز کردن در مرورگر پیش‌فرض...
              start "" "static-build\index.html"
              echo.
              echo 💡 نکته: شماره همراه وارد کنید: 09123456789
          ) else (
              echo ❌ خطا: فایل‌های آماده پیدا نشد!
              echo 🔄 لطفاً اطمینان حاصل کنید که فایل را به درستی Extract کرده‌اید.
          )

          echo.
          pause
          EOF

          # ایجاد فایل راه‌انداز مک/لینوکس
          cat > release-package/start-mac-linux.sh << 'EOF'
          #!/bin/bash
          echo "🚀 راه‌اندازی پروژه احراز هویت"
          echo "===================================="
          echo

          if [ -f "static-build/index.html" ]; then
              echo "✅ فایل‌های آماده پیدا شد!"
              echo "🌐 باز کردن در مرورگر..."
              
              # تشخیص سیستم عامل
              if [[ "$OSTYPE" == "darwin"* ]]; then
                  # macOS
                  open "static-build/index.html"
              elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
                  # Linux
                  xdg-open "static-build/index.html"
              fi
              
              echo "💡 نکته: شماره همراه وارد کنید: 09123456789"
          else
              echo "❌ خطا: فایل‌های آماده پیدا نشد!"
              echo "🔄 لطفاً اطمینان حاصل کنید که فایل را به درستی Extract کرده‌اید."
          fi
          EOF

          chmod +x release-package/start-mac-linux.sh

      - name: Create ZIP archive
        run: |
          cd release-package
          zip -r ../auth-project-${{ github.ref_name }}.zip .

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: auth-project-${{ github.ref_name }}.zip
          body: |
            ## 🎉 نسخه جدید پروژه احراز هویت

            ### ✨ ویژگی‌ها
            - 🔐 صفحه ورود با اعتبارسنجی کامل
            - 🏠 داشبورد کاربری زیبا
            - 📱 طراحی ریسپانسیو
            - 🌐 کاملاً آفلاین و محلی
            - 🎨 رابط کاربری مدرن فارسی

            ### 📥 نحوه استفاده

            **برای کاربران عادی:**
            1. فایل `auth-project-${{ github.ref_name }}.zip` را دانلود کنید
            2. فایل را Extract کنید
            3. روی `Start-Windows.bat` دابل کلیک کنید (ویندوز)
            4. یا `static-build/index.html` را در مرورگر باز کنید

            **برای توسعه‌دهندگان:**
            1. فایل ZIP را دانلود و Extract کنید
            2. وارد پوشه `source-code` شوید
            3. دستور `npm install` را اجرا کنید
            4. دستور `npm run dev` را اجرا کنید

            ### 🔗 لینک‌های مفید
            - [مشاهده دمو زنده](${{ github.server_url }}/${{ github.repository }})
            - [مستندات کامل](README.md)

            **شماره تست:** `09123456789`
