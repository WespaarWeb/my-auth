name: Create Release

on:
  push:
    tags:
      - "v*"

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: Install dependencies
        run: npm ci

      - name: Build project
        run: npm run build

      - name: Prepare release package
        run: |
          mkdir -p release-package

          # Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ static
          cp -r out release-package/static-build

          # Ú©Ù¾ÛŒ Ú©Ø¯ Ù…Ù†Ø¨Ø¹ (Ø¨Ø¯ÙˆÙ† node_modules)
          rsync -av --exclude='node_modules' --exclude='.next' --exclude='out' --exclude='.git' . release-package/source-code/

          # Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø¬Ø±Ø§
          cat > release-package/README.md << 'EOF'
          # ðŸš€ Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª - Ø¨Ø³ØªÙ‡ Ø¢Ù…Ø§Ø¯Ù‡

          ## ðŸ“ Ù…Ø­ØªÙˆÛŒØ§Øª
          - `static-build/` - ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ HTML/CSS/JS (Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Node.js)
          - `source-code/` - Ú©Ø¯ Ù…Ù†Ø¨Ø¹ Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†

          ## ðŸŒŸ Ø±ÙˆØ´ Ø§ÙˆÙ„: Ø§Ø¬Ø±Ø§ÛŒ ÙÙˆØ±ÛŒ (ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
          1. Ù¾ÙˆØ´Ù‡ `static-build` Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯
          2. ÙØ§ÛŒÙ„ `index.html` Ø±Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯
          3. Ø´Ù…Ø§Ø±Ù‡ Ù‡Ù…Ø±Ø§Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯: `09123456789`
          4. Ù„Ø°Øª Ø¨Ø¨Ø±ÛŒØ¯! ðŸŽ‰

          ## ðŸ› ï¸ Ø±ÙˆØ´ Ø¯ÙˆÙ…: ØªÙˆØ³Ø¹Ù‡ Ùˆ ØªØºÛŒÛŒØ±
          ```bash
          cd source-code
          npm install
          npm run dev
          ```

          ## âœ¨ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
          - ðŸ” Ø³ÛŒØ³ØªÙ… Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ú©Ø§Ù…Ù„
          - ðŸ“± Ø·Ø±Ø§Ø­ÛŒ Responsive
          - ðŸŒ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¢ÙÙ„Ø§ÛŒÙ†
          - ðŸŽ¨ UI/UX Ù…Ø¯Ø±Ù†
          - ðŸ”§ TypeScript + SCSS

          ## ðŸ“ž Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ
          Ø¯Ø± ØµÙˆØ±Øª Ù…Ø´Ú©Ù„ØŒ Issue Ø¬Ø¯ÛŒØ¯ Ø¯Ø± GitHub Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯.
          EOF

          # Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø² ÙˆÛŒÙ†Ø¯ÙˆØ²
          cat > release-package/Start-Windows.bat << 'EOF'
          @echo off
          echo ðŸš€ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
          echo ====================================
          echo.

          if exist "static-build\index.html" (
              echo âœ… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ø´Ø¯!
              echo ðŸŒ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶...
              start "" "static-build\index.html"
              echo.
              echo ðŸ’¡ Ù†Ú©ØªÙ‡: Ø´Ù…Ø§Ø±Ù‡ Ù‡Ù…Ø±Ø§Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯: 09123456789
          ) else (
              echo âŒ Ø®Ø·Ø§: ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!
              echo ðŸ”„ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø­Ø§ØµÙ„ Ú©Ù†ÛŒØ¯ Ú©Ù‡ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Extract Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.
          )

          echo.
          pause
          EOF

          # Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø² Ù…Ú©/Ù„ÛŒÙ†ÙˆÚ©Ø³
          cat > release-package/start-mac-linux.sh << 'EOF'
          #!/bin/bash
          echo "ðŸš€ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª"
          echo "===================================="
          echo

          if [ -f "static-build/index.html" ]; then
              echo "âœ… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ø´Ø¯!"
              echo "ðŸŒ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±..."
              
              # ØªØ´Ø®ÛŒØµ Ø³ÛŒØ³ØªÙ… Ø¹Ø§Ù…Ù„
              if [[ "$OSTYPE" == "darwin"* ]]; then
                  # macOS
                  open "static-build/index.html"
              elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
                  # Linux
                  xdg-open "static-build/index.html"
              fi
              
              echo "ðŸ’¡ Ù†Ú©ØªÙ‡: Ø´Ù…Ø§Ø±Ù‡ Ù‡Ù…Ø±Ø§Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯: 09123456789"
          else
              echo "âŒ Ø®Ø·Ø§: ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!"
              echo "ðŸ”„ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø­Ø§ØµÙ„ Ú©Ù†ÛŒØ¯ Ú©Ù‡ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Extract Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯."
          fi
          EOF

          chmod +x release-package/start-mac-linux.sh

      - name: Create ZIP archive
        run: |
          cd release-package
          zip -r ../auth-project-${{ github.ref_name }}.zip .

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: auth-project-${{ github.ref_name }}.zip
          body: |
            ## ðŸŽ‰ Ù†Ø³Ø®Ù‡ Ø¬Ø¯ÛŒØ¯ Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª

            ### âœ¨ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
            - ðŸ” ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ø§Ù…Ù„
            - ðŸ  Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø²ÛŒØ¨Ø§
            - ðŸ“± Ø·Ø±Ø§Ø­ÛŒ Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ
            - ðŸŒ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¢ÙÙ„Ø§ÛŒÙ† Ùˆ Ù…Ø­Ù„ÛŒ
            - ðŸŽ¨ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù…Ø¯Ø±Ù† ÙØ§Ø±Ø³ÛŒ

            ### ðŸ“¥ Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡

            **Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø§Ø¯ÛŒ:**
            1. ÙØ§ÛŒÙ„ `auth-project-${{ github.ref_name }}.zip` Ø±Ø§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯
            2. ÙØ§ÛŒÙ„ Ø±Ø§ Extract Ú©Ù†ÛŒØ¯
            3. Ø±ÙˆÛŒ `Start-Windows.bat` Ø¯Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ (ÙˆÛŒÙ†Ø¯ÙˆØ²)
            4. ÛŒØ§ `static-build/index.html` Ø±Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯

            **Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†:**
            1. ÙØ§ÛŒÙ„ ZIP Ø±Ø§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Extract Ú©Ù†ÛŒØ¯
            2. ÙˆØ§Ø±Ø¯ Ù¾ÙˆØ´Ù‡ `source-code` Ø´ÙˆÛŒØ¯
            3. Ø¯Ø³ØªÙˆØ± `npm install` Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯
            4. Ø¯Ø³ØªÙˆØ± `npm run dev` Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯

            ### ðŸ”— Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯
            - [Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ù…Ùˆ Ø²Ù†Ø¯Ù‡](${{ github.server_url }}/${{ github.repository }})
            - [Ù…Ø³ØªÙ†Ø¯Ø§Øª Ú©Ø§Ù…Ù„](README.md)

            **Ø´Ù…Ø§Ø±Ù‡ ØªØ³Øª:** `09123456789`
